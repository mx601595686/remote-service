# remote-service
这是一个抽象类库对于创建集群化JavaScript应用程序。
该库实现了一些创建集群化应用的关键部分，但并没有实现消息传递以及消息路由，
这样做是为了尽可能地提供灵活性，使它可以应用在更多地方。

## 标准规范介绍

### 服务管理器(ServicesManager)
管理服务容器的创建与销毁

#### 功能
* 管理所有`服务容器`的`创建(create)`、`启动(start)`、`关闭(close)`、`销毁(destroy)`
* 监控所有`服务容器`的运行状态变化，根据`服务容器`运行状态的变化来执行启动关闭服务的策略。`服务容器`的运行状态包括
    * `正在启动(starting)`
    * `正在运行(running)`
    * `正在关闭(closing)`
    * `已关闭(closed)`
* 检查服务名称是否合规
* 确定服务容器之间的启动顺序与关闭顺序

#### 重要概念
* 启动顺序：如果A服务依赖B服务，则B服务应当在A服务之前启动。
* 关闭顺序：如果A服务依赖B服务，则A服务应当在B服务之前关闭。
* 服务崩溃关闭顺序：当C依赖A，A依赖B，如果B崩溃，则先关闭C再关闭A。
* 父子关系：如果A服务是在B服务中创建的，则A会被强制要求依赖B提供的服务。也就是说子会在父关闭之前被关闭。
* 服务可获取性：只有当服务完全启动后，其他服务才能获取该服务，也就是说，如果A要获取B的服务，则A必须等到B完全启动之后才能被启动。
* 服务名：所有服务的服务名必须唯一

### 服务容器(ServiceContainer)
一个服务运行的环境。一个服务容器是有两部分构成的，`服务控制器(ServiceController)`与`远程服务(RemoteService)`。

#### 功能
* 创建服务执行环境（例如创建一个新的进程会docker容器等等）
* `设置`服务的执行权限
    * 文件读写
    * 依赖的其他服务的名称
    * 开启子服务
    * 访问网络
    * 等等...
* 控制容器内部服务的`启动(start)`、`关闭(close)`
* 设置服务运行的代码字符串

#### 重要概念
* 每`启动(start)`一次就有一个新的`服务控制器(ServiceController)`和`远程服务(RemoteService)`被创建。
* 一旦`关闭(close)`服务，对应的`服务控制器(ServiceController)`和`远程服务(RemoteService)`就会被销毁。
* 一个服务容器中只能运行一个服务

### 服务控制器(ServiceController)
用于控制一个远程的服务。

#### 功能
* 控制远端服务的`关闭(close)`
* 监控`远端服务`的运行状态包括
    * `正在启动(starting)`
    * `正在运行(running)`
    * `正在关闭(closing)`
    * `已关闭(closed)`
* 记录服务运行期间所有未捕获的异常信息。
* 记录服务运行期间的标准输出(stdout)、标准错误输出(stderr)。
* 服务的资源消耗情况（cpu与内存）
* 监控网络连接，如果服务控制器与远程服务断开连接，则远程服务会被直接关闭。

重要概念：
* ServiceController与RemoteService之间传递的消息只能通过事件，使用特定类型来标记。
* ServiceController无法访问RemoteService提供的服务和事件消息。


### 远程服务(RemoteService)
一个远程服务控制器。用于处理对应控制器或其他远程服务发送过来的请求和事件。

重要概念：
* 导出的服务(exportServices)：这是一个只包含方法的对象，可以是同步或是(`promise`)异步方法。其他服务可通过`sendInvoke()`的方式来调用这些服务。
* 导出的私有服务(exportPrivateServices)：功能和`exportServices`一样，不过这里面提供的服务只有该服务所对应的远程服务控制器才能调用。
* 事件(event)：服务可以通过`sendEvent()`的方式来发送事件。所有依赖了该服务的其他服务都会收到对应的消息通知。
* 私有事件(privateEvent)：功能和`event`一样，不过私有事件只会发送给该服务所对应的远程服务控制器。

### 通信连接端口(ConnectionPort)
抽象化了消息的传递，具体消息传递方式由用户来实现。同时提供了对收发消息的验证，确保消息的正确。

